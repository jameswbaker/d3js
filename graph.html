<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>D3 Graph From Scratch</title>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <style>
            html, body, svg {
                width: 100%;
                height: 100%;
            }
            body {
                margin: 0;
                overflow: hidden;
                font-family: sans-serif;
            }
            circle {
                cursor: grab;
            }
            circle:active {
                cursor: grabbing;
            }
        </style>
    </head>
    <body>
        <svg width="100%" height="100%"></svg>
        <script>
            
            const nodes = [
                { id: "A" },
                { id: "B" },
                { id: "C" },
                { id: "D" }
            ]

            const links = [
                { source: "A", target: "B" },
                { source: "A", target: "C" },
                { source: "B", target: "D" }
            ]

            const svg = d3.select("svg");

            const g = svg.append("g")

            const linkGroup = g.append("g").attr("stroke", "#999");
            const nodeGroup = g.append("g").attr("stroke", "#fff").attr("stroke-width", 1.5);

            const link = linkGroup
                .selectAll("line")
                .data(links)
                .join("line")
                .attr("stroke-width", 2);

            const node = nodeGroup
                .selectAll("circle")
                .data(nodes)
                .join("circle")
                .attr("r", 12)
                .attr("fill", "steelblue")

            const simulation = d3.forceSimulation(nodes)
                .force("link", d3.forceLink(links).id(d => d.id).distance(120))
                .force("charge", d3.forceManyBody().strength(-400))
                .force("center", d3.forceCenter(window.innerWidth / 2, window.innerHeight / 2))
                .on("tick", ticked);

            node.call(drag());

            function ticked() {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node
                    .attr("cx", d => d.x)
                    .attr("cy", d => d.y);
            }

            function drag() {

                function dragstarted(event, d) {
                    if (!event.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                }

                function dragged(event, d) {
                    d.fx = event.x;
                    d.fy = event.y;
                }

                function dragended(event, d) {
                    if (!event.active) simulation.alphaTarget(0);
                    d.fx = null;
                    d.fy = null;
                }

                return d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended);
            }

            // svg.call(
            //   d3.zoom()
            //     .scaleExtent([0.1, 5])
            //     .on("zoom", (event) => {
            //       g.attr("transform", event.transform);
            //     })
            // );

            </script>
    </body>
</html>